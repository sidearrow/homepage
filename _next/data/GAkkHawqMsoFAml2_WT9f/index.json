{"pageProps":{"articles":[{"id":"infomation-gathering-gis","title":"GIS x Web アプリケーション関連技術について","description":"GIS と Web アプリケーション関連の技術について情報収集しており、適宜更新予定です。","html":"<p>現状、体系的にまとめる程度の知識がなく、備忘録的なコンテンツになっていること、ご了承ください。</p>\n<h2 id=\"データ形式\">データ形式</h2>\n<ol>\n<li><p>ラスターデータ</p>\n<ul>\n<li>ビットマップ画像</li>\n</ul>\n</li>\n<li><p>ベクターデータ</p>\n<ul>\n<li>数値等の属性をデータに含めることが可能</li>\n<li>シェープファイルが広く用いられている</li>\n<li>Web アプリケーションでは以下のフォーマットが利用される<ul>\n<li>KML</li>\n<li>GeoJSON</li>\n<li>Google Protocol Buffers</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"バイナリベクトルタイル\">バイナリベクトルタイル</h2>\n<p>ベクターデータをタイル形式に分割したもの。\n<a href=\"https://github.com/mapbox/tippecanoe\">tippecanoe</a> を利用し、GeoJSON -&gt; Vector tiles (.mbtiles) -&gt; pbf と変換が可能。</p>\n<h2 id=\"地図表示のための-javascript-ライブラリ\">地図表示のための JavaScript ライブラリ</h2>\n<ul>\n<li>Leaflet</li>\n<li>OpenLayers</li>\n<li>Mapbox GL JS</li>\n</ul>\n<h2 id=\"独自タイルの配信方法\">独自タイルの配信方法</h2>\n<p>個人的な利用であれば、静的サイト用のホスティングサービスを利用すると手軽に無料で実現できます。\n実運用を考えた場合、AWS S3 あたりが良いのかと。</p>\n"},{"id":"laravel-single-action-controller","title":"Laravel Single Action Controller のすすめ","description":null,"html":"<p>こちらの話題については様々な記事等で既出ではありますが、個人的に好きな方法のため書かせていただきました。</p>\n<h2 id=\"single-action-controller-とは\">Single Action Controller とは</h2>\n<p>一つのアクションのみが定義された Controller クラスを指す。\n<code>artisan</code> コマンドで Controller を作成する際に、オプション <code>--invokable</code> を付与する。</p>\n<pre><code class=\"language-sh\">$ php artisan make:controller &lt;name&gt; --invokable</code></pre>\n<p>Controller クラス内には <code>__invoke()</code> メソッドが定義されており、こちらのメソッドで Request オブジェクトを受け取り、 Response オブジェクトを返却する。\n<code>__invoke()</code> メソッドは PHP のマジックメソッドで、オブジェクトを関数として呼び出した際に実行される。</p>\n<p><strong>（参考）</strong></p>\n<ul>\n<li><a href=\"https://laravel.com/docs/8.x/controllers#single-action-controllers\">https://laravel.com/docs/8.x/controllers#single-action-controllers</a></li>\n<li><a href=\"https://www.php.net/manual/ja/language.oop5.magic.php#object.invoke\">https://www.php.net/manual/ja/language.oop5.magic.php#object.invoke</a></li>\n</ul>\n<h2 id=\"single-action-controller-のメリット・デメリット\">Single Action Controller のメリット・デメリット</h2>\n<h3 id=\"メリット\">メリット</h3>\n<h4 id=\"一つの-controller-クラス内に存在するアクションが減り、見通しが良くなる\">一つの Controller クラス内に存在するアクションが減り、見通しが良くなる</h4>\n<p>Fat, Skinny Controller の話題について、個人的には各アクション内の処理も対象かと思いますので、Controller が Fat になるのを避けるには、アクション内の実装にも気をつけたいところです。</p>\n<h4 id=\"router-に登録する際の記述が簡潔\">Router に登録する際の記述が簡潔</h4>\n<p>引数のアクション部分に Controller クラスの完全修飾名を <code>:class</code> を使用して指定すればよい。\nSingle Action Controller でない場合の記述では、メソッド名を間違えていもそのルートにアクセスしない限りエラーにならないので、そちらが回避できるのも Single Action Controller のメリットでしょうか。</p>\n<pre><code class=\"language-php\"><span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">App</span>\\<span class=\"hljs-title\">Http</span>\\<span class=\"hljs-title\">Controllers</span>\\<span class=\"hljs-title\">HogeController</span>;\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">App</span>\\<span class=\"hljs-title\">Http</span>\\<span class=\"hljs-title\">Controllers</span>\\<span class=\"hljs-title\">FugaController</span>;\n\n<span class=\"hljs-comment\"># Single Action Controller</span>\nRoute::get(<span class=\"hljs-string\">'/hoge'</span>, HogeController::class);\n\n<span class=\"hljs-comment\"># Not Single Action Controller</span>\nRoute::get(<span class=\"hljs-string\">'/fuga'</span>, [FugaController::class, <span class=\"hljs-string\">'index'</span>]);</code></pre>\n<h3 id=\"デメリット\">デメリット</h3>\n<h4 id=\"resource-controller-が使用できない\">Resource Controller が使用できない</h4>\n<p>要件にあった場合、Resource Controller を利用すると圧倒的に記述量を減らすことが可能です。そのような場合、Resource Controller と併用することを検討したいです。</p>\n<p><strong>（参考）</strong></p>\n<ul>\n<li><a href=\"https://laravel.com/docs/8.x/controllers#resource-controllers\">https://laravel.com/docs/8.x/controllers#resource-controllers</a></li>\n</ul>\n"},{"id":"next-js-ssg-on-github-pages","title":"Next.js の SSG 機能で出力した静的サイトを GitHub Pages で公開する","description":"Next.js の SSG 機能で出力した静的サイトを GitHub Pages で公開する手順です。","html":"<h2 id=\"環境\">環境</h2>\n<ul>\n<li>Next.js: 9.5.3</li>\n</ul>\n<h2 id=\"nextjs-で-ssg-する\">Next.js で SSG する</h2>\n<p><code>next build</code> 後に <code>next export</code> で、<code>out</code> フォルダに HTML, CSS, JS 等が出力される。\n<code>package.json</code> の <code>scripts</code> に 以下あたりを追加しておく。</p>\n<pre><code class=\"language-json\">{\n    <span class=\"hljs-attr\">\"scripts\"</span>: {\n        <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"next build &amp;&amp; next export\"</span>\n    }\n}</code></pre>\n<h2 id=\"nextjs-アプリのビルド時の注意点\">Next.js アプリのビルド時の注意点</h2>\n<p>GitHub リポジトリ名が <code>&lt;ユーザー名&gt;.github.io</code> の場合、公開 URL は <code>https://&lt;ユーザー名&gt;.github.io</code> だが、\nそれ以外のリポジトリ名の場合、公開 URL は <code>https://&lt;ユーザー名&gt;.github.io/&lt;リポジトリ名&gt;</code> になる。</p>\n<p>そのため、後者の場合、Next.js をビルドする際は <code>next.config.js</code> に設定を追加する必要がある。</p>\n<pre><code class=\"language-js\"><span class=\"hljs-built_in\">module</span>.exports = {\n  <span class=\"hljs-attr\">assetPrefix</span>: <span class=\"hljs-string\">'&lt;プレフィックス（本ケースではリポジトリ名）&gt;'</span>,\n}</code></pre>\n<p>（参考）<a href=\"https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix\">https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix</a></p>\n<p>ただ、上記の設定では開発時も適用される。環境変数で設定を出し分ける方法もあるが、Next.js で用意されている定数 <code>PHASE_*</code> を利用する。</p>\n<pre><code class=\"language-js\"><span class=\"hljs-keyword\">const</span> { PHASE_PRODUCTION_BUILD } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'next/constants'</span>);\n\n<span class=\"hljs-built_in\">module</span>.exports = <span class=\"hljs-function\">(<span class=\"hljs-params\">phase, { defaultConfig }</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">if</span> (phase === PHASE_PRODUCTION_BUILD) {\n    <span class=\"hljs-keyword\">return</span> { <span class=\"hljs-attr\">assetPrefix</span>: <span class=\"hljs-string\">'...'</span> };\n  }\n  <span class=\"hljs-keyword\">return</span> {};\n}</code></pre>\n<p>（参考）<a href=\"https://nextjs.org/docs/api-reference/next.config.js/introduction\">https://nextjs.org/docs/api-reference/next.config.js/introduction</a></p>\n<h2 id=\"github-actions-の設定\">GitHub Actions の設定</h2>\n<p><code>.github/workflows</code> ディレクトリ配下に適当な名前で以下のような yml を作成。\n公開ディレクトリ直下に <code>.nojekyll</code> といったファイルがないと、<code>_next</code> ディレクトリが公開されないようなので、ビルド後に作成している。</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">github</span> <span class=\"hljs-string\">pages</span>\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span>\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v2</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v2.1.0</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-number\">12.</span><span class=\"hljs-string\">x</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">install</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">install</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          yarn run build\n          touch out/.nojekyll\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">deploy</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peaceiris/actions-gh-pages@v3.6.4</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">github_token:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">publish_dir:</span> <span class=\"hljs-string\">./out</span></code></pre>\n"}]},"__N_SSG":true}